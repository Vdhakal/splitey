name: Discord Notification on Pull Request

on:
  pull_request:
    types: [opened, reopened, edited, synchronize, closed]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: https://discord.com/api/webhooks/1363237027688087622/Hvf-0zMTpYnr2rRiso0o_Pj4GRJr4J_T6q7L98TKuXA-4gYQZfFUCjYVZscfNPdSst_q
        run: |
          PR_AUTHOR=$(echo ${{ github.event.pull_request.user.login }} | sed 's/[^a-zA-Z0-9_]/_/g')
          PR_TITLE=$(echo "${{ github.event.pull_request.title }}" | jq -sRr @uri)
          PR_URL=${{ github.event.pull_request.html_url }}
          
          if [[ "${{ github.event.action }}" == "opened" ]]; then
            MESSAGE="New pull request opened by ${PR_AUTHOR}: ${PR_TITLE} - ${PR_URL}"
          elif [[ "${{ github.event.action }}" == "reopened" ]]; then
            MESSAGE="Pull request reopened by ${PR_AUTHOR}: ${PR_TITLE} - ${PR_URL}"
          elif [[ "${{ github.event.action }}" == "edited" ]]; then
            MESSAGE="Pull request edited by ${PR_AUTHOR}: ${PR_TITLE} - ${PR_URL}"
          elif [[ "${{ github.event.action }}" == "synchronize" ]]; then
            MESSAGE="Pull request synchronized by ${PR_AUTHOR}: ${PR_TITLE} - ${PR_URL}"
          elif [[ "${{ github.event.action }}" == "closed" ]]; then
            if ${{ github.event.pull_request.merged }}; then
              MESSAGE="Pull request merged by ${PR_AUTHOR}: ${PR_TITLE} - ${PR_URL}"
            else
              MESSAGE="Pull request closed by ${PR_AUTHOR}: ${PR_TITLE} - ${PR_URL}"
            fi
          fi
          
          curl -H "Content-Type: application/json" -d "{\"content\": \"$MESSAGE\"}" $DISCORD_WEBHOOK
